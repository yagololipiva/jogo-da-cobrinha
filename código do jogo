import pygame
import random
import os

pygame.init()
pygame.mixer.init()

# Cores
COR_FUNDO = (30, 30, 30)
COR_TEXTO = (255, 255, 255)
COR_COBRA = (0, 255, 100)
COR_COMIDA = (255, 80, 80)
COR_BOTAO = (70, 130, 180)
COR_BOTAO_HOVER = (90, 150, 200)
COR_BOTAO_MUTE = (180, 180, 0)

# Tela
largura, altura = 600, 400
tela = pygame.display.set_mode((largura, altura))
pygame.display.set_caption("Jogo da Cobrinha")

# Configura√ß√µes
relogio = pygame.time.Clock()
tamanho_quadrado = 20
velocidade_jogo = 15

# Fontes
fonte_pontos = pygame.font.SysFont("consolas", 24, bold=True)
fonte_game_over = pygame.font.SysFont("arial", 48, bold=True)
fonte_botao = pygame.font.SysFont("arial", 24, bold=True)
fonte_menu = pygame.font.SysFont("arial", 36, bold=True)

# Sons
som_comida = pygame.mixer.Sound("comida.wav")
som_game_over = pygame.mixer.Sound("game_over.wav")
pygame.mixer.music.load("fundo.wav")

# Mute flag
mutado = False

# Recorde
arquivo_recorde = "recorde.txt"
def carregar_recorde():
    if os.path.exists(arquivo_recorde):
        with open(arquivo_recorde, "r") as f:
            return int(f.read())
    return 0

def salvar_recorde(pontos):
    with open(arquivo_recorde, "w") as f:
        f.write(str(pontos))

def desenhar_cobra(lista_pixels):
    for pixel in lista_pixels:
        pygame.draw.rect(tela, COR_COBRA, [pixel[0], pixel[1], tamanho_quadrado, tamanho_quadrado], border_radius=4)

def gerar_comida():
    comida_x = round(random.randrange(0, largura - tamanho_quadrado) / 20.0) * 20.0
    comida_y = round(random.randrange(0, altura - tamanho_quadrado) / 20.0) * 20.0
    return comida_x, comida_y

def desenhar_comida(x, y):
    pygame.draw.rect(tela, COR_COMIDA, [x, y, tamanho_quadrado, tamanho_quadrado], border_radius=6)

def desenhar_pontos(pontos, recorde):
    texto = fonte_pontos.render(f"Pontos: {pontos}   Recorde: {recorde}", True, COR_TEXTO)
    tela.blit(texto, (10, 10))

def desenhar_botao_mute(mute):
    texto = "üîá" if mute else "üîä"
    botao_texto = fonte_pontos.render(texto, True, COR_BOTAO_MUTE)
    botao_rect = pygame.Rect(largura - 50, 10, 40, 40)
    pygame.draw.rect(tela, COR_FUNDO, botao_rect)
    tela.blit(botao_texto, (botao_rect.x + 10, botao_rect.y + 5))
    return botao_rect

def mostrar_game_over(pontos, recorde):
    tela.fill(COR_FUNDO)
    texto = fonte_game_over.render("Fim de Jogo", True, COR_COMIDA)
    tela.blit(texto, (largura // 2 - texto.get_width() // 2, altura // 2 - 80))

    if pontos > recorde:
        salvar_recorde(pontos)
        recorde = pontos

    texto_recorde = fonte_botao.render(f"Seu placar: {pontos}  |  Recorde: {recorde}", True, COR_TEXTO)
    tela.blit(texto_recorde, (largura // 2 - texto_recorde.get_width() // 2, altura // 2 - 30))

    texto_botao = fonte_botao.render("Reiniciar (Enter)", True, COR_TEXTO)
    botao_rect = pygame.Rect(largura // 2 - 150, altura // 2 + 30, 300, 50)

    mouse_pos = pygame.mouse.get_pos()
    cor_botao = COR_BOTAO_HOVER if botao_rect.collidepoint(mouse_pos) else COR_BOTAO
    pygame.draw.rect(tela, cor_botao, botao_rect, border_radius=10)
    tela.blit(texto_botao, (botao_rect.centerx - texto_botao.get_width() // 2,
                            botao_rect.centery - texto_botao.get_height() // 2))
    return botao_rect

def menu_inicial():
    tela.fill(COR_FUNDO)
    titulo = fonte_menu.render("Jogo da Cobrinha", True, COR_COBRA)
    botao_texto = fonte_botao.render("Jogar", True, COR_TEXTO)
    botao_rect = pygame.Rect(largura // 2 - 100, altura // 2, 200, 50)

    while True:
        tela.fill(COR_FUNDO)
        tela.blit(titulo, (largura // 2 - titulo.get_width() // 2, altura // 3 - 40))
        mouse_pos = pygame.mouse.get_pos()
        cor = COR_BOTAO_HOVER if botao_rect.collidepoint(mouse_pos) else COR_BOTAO
        pygame.draw.rect(tela, cor, botao_rect, border_radius=10)
        tela.blit(botao_texto, (botao_rect.centerx - botao_texto.get_width() // 2,
                                botao_rect.centery - botao_texto.get_height() // 2))
        pygame.display.update()

        for evento in pygame.event.get():
            if evento.type == pygame.QUIT:
                pygame.quit()
                exit()
            elif evento.type == pygame.MOUSEBUTTONDOWN:
                if botao_rect.collidepoint(evento.pos):
                    return
            elif evento.type == pygame.KEYDOWN:
                if evento.key in [pygame.K_RETURN, pygame.K_SPACE]:
                    return

def rodar_jogo():
    global mutado
    if not mutado:
        pygame.mixer.music.play(-1)

    fim_do_jogo = False
    x, y = largura // 2, altura // 2
    velocidade_x = velocidade_y = 0
    tamanho_cobra = 1
    pixels = []
    comida_x, comida_y = gerar_comida()
    recorde = carregar_recorde()

    while True:
        tela.fill(COR_FUNDO)
        desenhar_comida(comida_x, comida_y)
        desenhar_cobra(pixels)
        desenhar_pontos(tamanho_cobra - 1, recorde)
        botao_mute = desenhar_botao_mute(mutado)

        for evento in pygame.event.get():
            if evento.type == pygame.QUIT:
                pygame.quit()
                exit()

            elif evento.type == pygame.MOUSEBUTTONDOWN:
                if botao_mute.collidepoint(evento.pos):
                    mutado = not mutado
                    if mutado:
                        pygame.mixer.music.set_volume(0)
                    else:
                        pygame.mixer.music.set_volume(1)

            elif evento.type == pygame.KEYDOWN and not fim_do_jogo:
                if evento.key == pygame.K_LEFT and velocidade_x == 0:
                    velocidade_x, velocidade_y = -tamanho_quadrado, 0
                elif evento.key == pygame.K_RIGHT and velocidade_x == 0:
                    velocidade_x, velocidade_y = tamanho_quadrado, 0
                elif evento.key == pygame.K_UP and velocidade_y == 0:
                    velocidade_y, velocidade_x = -tamanho_quadrado, 0
                elif evento.key == pygame.K_DOWN and velocidade_y == 0:
                    velocidade_y, velocidade_x = tamanho_quadrado, 0

            elif fim_do_jogo:
                if evento.type == pygame.KEYDOWN:
                    if evento.key in [pygame.K_RETURN, pygame.K_SPACE]:
                        return
                elif evento.type == pygame.MOUSEBUTTONDOWN:
                    if botao_game_over.collidepoint(evento.pos):
                        return

        if not fim_do_jogo:
            x += velocidade_x
            y += velocidade_y

            if x < 0 or x >= largura or y < 0 or y >= altura:
                fim_do_jogo = True
                if not mutado:
                    som_game_over.play()

            pixels.append([x, y])
            if len(pixels) > tamanho_cobra:
                del pixels[0]

            for pixel in pixels[:-1]:
                if pixel == [x, y]:
                    fim_do_jogo = True
                    if not mutado:
                        som_game_over.play()

            if x == comida_x and y == comida_y:
                tamanho_cobra += 1
                comida_x, comida_y = gerar_comida()
                if not mutado:
                    som_comida.play()
        else:
            botao_game_over = mostrar_game_over(tamanho_cobra - 1, recorde)

        pygame.display.update()
        relogio.tick(velocidade_jogo)

# Execu√ß√£o
menu_inicial()
while True:
    rodar_jogo()
